# 1. 绪论

## 1. 基础

1. 互联网的组成：

   1. 边缘部分：由所有连接在因特网上的主机组成。这部分由用户直接使用，进行通信和资源共享。
   2. 核心部分：由大量的网络和连接这些网络的路由器组成。这部分为边缘部分提供服务（连通性和交换）

2. 边缘部分的用户通信方式：

   1. 客户服务器方式（C/S）：Client/Server方式。客户是服务请求方，服务器是服务提供方。
   2. 对等方式（P2P方式）：即Peer-to-Peer方式。对等连接中的每一个主机既是客户又是服务器。

3. [核心部分的交换技术](https://blog.csdn.net/u012557765/article/details/81638446)：

   ![](https://gitee.com/wychz/PicGoBed/raw/master/img/20210228165314.png)

   1. 电路交换：整个报文的比特流连续的从源直达终点，好像在一个管道中传输
   2. 报文交换：整个报文先传输到相邻的绩点，全部存储下来后查找转发表，转发到下一个节点
   3. 分组交换：单个分组（报文的一部分）传输到相邻节点，存储下来后查找转发表，转发到下一个节点。

## 2. 性能指标

1. 速率：单位时间内传送的比特数。

2. 带宽：单位时间内从网络中某一点到另一点所能通过的最高速率。

3. 吞吐量：单位时间内通过网路的实际数据量。其上限等于带宽。

4. 时延：数据从网络一段传送到另一端所需的时间：

   1. 发送时延：主机或者路由器发送数据帧所需要的的时间。$发送时延=\frac{数据帧长度(b)}{发送速率(b/s)}$
   2. 传播时延：电磁波在信道中传播一定距离所需要的时间。$传播时延=\frac{信道长度(m)}{电磁波在信道的传输速率(m/s)}$
   3. 处理时延：主机或者路由器在接收到分组时，进行处理的时间。如首部分析，数据提取，差错校验，路由查找等。
   4. 排队时延：分组进入路由器后现在输入队列中等待。在路由器确定了转发接口时，在输出队列中等待。

   * 总时延：$总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延$。

5. 链路容量（时延带宽积）：一个链路可以容纳的最多比特。$时延带宽积=传播时延*带宽$

6. 往返时间RTT：从发送方发送数据开始，发送方收到接收方的确认为止所花费时间。

## 3. [网络设备](https://blog.csdn.net/hushhw/article/details/78489470)

### 1. 物理层设备

1. 中继器：扩展局域网网段的长度。在两个局域网网段之间实现电信号的恢复和整形。
2. 集线器：可看做特殊的多路中继器。具有信号放大功能。优点是当网络系统中某条线路或某结点出现故障时，不会影响网上其他结点的正常工作。

### 2. 数据链路层设备

1. 网桥：网桥分析帧地址字段，决定是否要把帧转发到另一个网段上。网桥工作与MAC自层，若两个网络的MAC子层以上的协议相同，都可以用网桥互连。

   * 网桥检查帧的源地址和目的地址，如果目的地址和源地址不在同一个网络段上，就把帧转发到另一个网络段上；若两个地址在同一个网络段上，则不转发，所以网桥能起到过滤帧的作用。
   * 分类：透明网桥、源路由网桥

2. 交换机：按每一个包中的MAC地址进行转发。不考虑更深的信息。

   * 工作模式：存储转发，快速转发，碎片丢弃。

   * 第二层交换机：工作在数据链路层。将多台数据终端设备连接成星型网络。识别MAC地址，根据MAC地址转发，并将MAC地址与对应的端口记录在内部地址表中。
   * 第三层交换机：工作在网络层。完成普通路由器的全部或部分功能。

### 3. 网络层设备

1. 路由器：连接多个逻辑上分开的网络。
   * 通常把网络层地址称为逻辑地址，数据链路层地址称为物理地址。
   * 路由器主要功能为路径选择。路由器内部维护路由表，记录各个网络的逻辑地址。还有过滤，存储转发， 流量管理，介质转换等功能。

### 4. 应用层设备

1. 网关：在同一个计算机网络中，当连接不同类型而协议差别较大的网络时，使用网关。
   * 将协议进行转换，将数据重新分组，以便两个不同类型网络进行通信。
   * 网关一般只能进行一对一转换，或者少数几个特定应用协议的转换，所以网关很难实现通用协议转换。

# 2. 物理层

1. 通信方式：

   1. 单工：单向通信
   2. 半双工：双向交替通信
   3. 全双工：双向同时通信

2. 信道复用技术：

   1. 频分复用（FDM）：所有用户在同样的时间内占用不同的频率带宽资源

   2. 时分复用（TDM）：将时间划分为一段段等长的时分复用帧。

   3. 统计时分复用（STDM）：改进了时分复用，提高信道利用率。

   4. 波分复用（WDM）：广德频分复用

   5. 码分复用（CDM）：码分多址CDMA。

      ![](https://gitee.com/wychz/PicGoBed/raw/master/img/20210228171659.png)

# 3. 数据链路层

数据链路层不必考虑物理层如何实现比特传输的细节，可以想象为沿着两个数据链路层的水平方向把帧直接发送给对方。

1. 信道类型：
   1. 点对点信道
   2. 广播信道

## 1. 点对点信道

### 1. 链路

1. 链路：从一个结点到相邻结点的一段物理链路（有线或无线），中间没有任何其他的交互结点。
2. 数据链路：把实现通信协议的软件和硬件加到链路上，构成数据链路。在线路上传播数据时，除了物理链路，还要有一些必要的通信协议来控制这些数据传输。

### 2. 帧

1. 点对点信道的数据链路层的协议数据单元。 数据链路层把网络层的数构成帧发送到链路上，以及把接收到的帧中的数据取出并交给网络层。

   * 通信步骤：

     1. 结点A的数据链路层把网络层交付的IP数据报添加首部和尾部，封装成帧
     2. 结点A把封装好的帧发给结点B的数据链路层
     3. 若结点B的数据链路层收到的帧无差错，则从帧中提取出IP数据报交付给网络层，否则丢包。

     ![](https://gitee.com/wychz/PicGoBed/raw/master/img/20210228172447.png)

### 3. 封装成帧

在一段数据的前后添加首部和尾部，构成一个帧。首部和尾部的一个重要作用就是帧定界。

![](https://gitee.com/wychz/PicGoBed/raw/master/img/20210228173309.png)

当数据帧是由可打印的ASCII码组成的文本文件，使用特殊的帧定界符。当帧出现差错时，根据帧定界符判断数据是不是完整的帧。

1. 控制字符SOH（Start Of Header）：16进制为01（00000001）
2. 控制字符EOT（End Of Transmission）：16进制为04（00000100）

![](https://gitee.com/wychz/PicGoBed/raw/master/img/20210228173327.png)

### 4. 透明传输

当出现数据中某个二进制代码恰好和SOH和EOT一样，数据链路层会找到错误的帧边界。

* 解决方法：

  * **零比特填充**：PPP使用同步传输

    只要发现有5个连续的1，就立即填入一个0。

  * **字节填充/字节填充**：PPP使用异步传输

    发送端的数据链路层在控制字符SOH和EOT前面插入一个转义字符“ESC”(其十六进制编码是 1B)。接收端在数据送往网络层之前，删除插入的转义字符。当转义字符也出现在数据当中，在转义字符前在插入一个转义字符。当接收端收到两个连续的转义字符，删除前面的一个。

    ![](https://gitee.com/wychz/PicGoBed/raw/master/img/20210228174209.png)

    

### 5. 差错检测

传输过程中可能出现**比特差错**。0变成1，或1变成0。在一段时间内，传输错误的比特占总数的比率称为误码率（BER）。

* 造成原因：信号衰减，电磁噪声。与信噪比关系很大。
* 解决方案：差错检测，纠正比特（EDC）。链路层检测到差错时，通知发送方重传或者直接丢帧。
  * 奇偶校验方法，校验和方法，循环冗余检测。

## 2. 广播信道

广播信道是一种一对多的信道，局域网使用广播信道。

### 1. CSMA/CD协议

CSMA/CD全名**载波监听多点接入/碰撞检测**。

1. **多点接入**：计算机以多点接入的方式连接在一根总线上
2. **载波监听**：“发送前先监听”。每一个站在发送数据前监测总线是否有其他站在发送数据，如果有则暂时不发送，等信道空闲为止
3. **碰撞检测**：“边发送边监听”。适配器发送数据边监测信道上的信号电压变化情况。当一个站监测到的信息电压 摆动值超过一定门限值，就认为总线上至少有两个站在同时发送数据，就立即停止发送，避免继续浪费网络资源。随机等待一段时间后继续发送。

# 4. 网络层

## 1. IP协议

网际协议IP是TCP/IP体系中两个最重要的协议之一。配套协议有：

1. 地址解析协议ARP：是解决同一个局域网上的主机或路由器的IP地址和硬件地址的映射问题。
2. 逆地址解析协议RARP：是解决同一个局域网上的主机或路由器的硬件地址和IP地址的映射问题。
3. 网际控制报文协议ICMP：提供差错报告和询问报文，以提高IP数据交付成功的机会
4. 网际组管理协议IGMP：：用于探寻、转发本局域网内的组成员关系。

### 1. IP地址

IP地址是指互联网协议地址，是IP协议提供的一种统一的地址格式，它为互联网上的每一个网络和每一台主机分配一个逻辑地址，以此来屏蔽物理地址的差异。将IP地址划分为若干固定类。每一类地址由两个固定长度的字段组成《网络号-主机号》

由器至少应当连接到两个网络，路由器至少有两个不同的IP地址。

![](https://gitee.com/wychz/PicGoBed/raw/master/img/20210228183052.jpg)

![](https://gitee.com/wychz/PicGoBed/raw/master/img/20210228183059.jpg)

1. A类地址：
   1. 网络数：$128 - 2$。 0.0.0.0为本网络，127.0.0.1位本地软件的回环地址，测试自己电脑IP地址是否可用。
   2. 主机数：$2^{24} -2$。全0主机号：该IP地址是本主机。全1主机号：表示该网络上所有主机
2. B类地址：
   1. 网络数：$2^{14} - 1$。128.0.0.0不指派
   2. 主机数：$2^{16}-2$。全0全1除外
3. C类地址：
   1. 网络数：$2^{21} - 1$。192.0.0.0不指派
   2. 主机数：$2^{8}-2$。全0全1除外

### 2. 划分子网

一个拥有许多物理网络的单位，可将所属的物理网络划分为若干个**子网**(subnet)。划分子网对外仍然表现为一个网络。

1. 划分方式：从主机号借用若干位作为子网号。IP地址={网络号，子网号，主机号}

2. 使用方式：本单位路由器接收到其他网络发来的IP数据报，根据网络号和子网号找到目的子网，将IP数据报交付给目的主机。

3. 子网掩码：路由器把子网掩码和IP地址进行逻辑与操作。找出子网的网络地址。（划分子网后，路由表包括：目的网络地址，子网掩码，下一跳地址）

   ![](https://gitee.com/wychz/PicGoBed/raw/master/img/20210228184548.png)

4. 路由器转发分组算法：
   1. 从分组首部提取目的IP地址D
   2. 用各网络的子网掩码与D相与。匹配则交付。
   3. 若路由表中有目的地址为D的特定主机路由，则传送给下一跳路由器。
   4. 对路由表中每一行的子网掩码与D相与，若结果匹配，则传送给该行的下一跳路由器
   5. 若路由表中有一个默认路由，则传送给默认路由器
   6. 报告转发分组出错。

### 3.构造超网：**CIDR（无分类编址）**

1. 定义：消除了A, B, C类地址和划分子网的概念。用网络前缀代替网络号和子网号，后面部分指明主机。
2. 地址掩码：由一连串的1和0构成。1的个数为网络前缀长度。斜线计法中，斜线后面的数字为地址掩码中1的个数。

### 4. IP地址和硬件地址

1. IP地址：网络层和以上各层使用；逻辑地址
2. 硬件地址：数据链路层和物理层使用；
3. IP地址放在IP数据报首部，硬件地址在MAC帧首部。数据报进入数据链路层后，IP数据报成为MAC帧的数据，不可见。

### 5. ARP协议：地址解析协议

**解决同一个局域网上IP地址和硬件地址的映射问题。**

1. 每台主机都会在自己的ARP缓冲区中建立一个ARP列表，以表示IP地址和MAC地址的对应关系。当源主机需要将一个数据包要发送到目的主机时，会首先检查自己ARP列表中是否存在该IP地址对应的MAC地址
2. 如果有，就将数据包发送到这个MAC地址；如果没有，就向本地网段发起一个ARP请求的广播包，查询此目的主机对应的MAC地址。此ARP请求数据包里包括源主机的IP地址、硬件地址、以及目的主机的IP地址。网络中所有的主机收到这个ARP请求后，会检查数据包中的目的IP是否和自己的IP地址一致。如果不相同就忽略此数据包；如果相同，该主机首先将发送端的MAC地址和IP地址添加到自己的ARP列表中，如果ARP表中已经存在该IP的信息，则将其覆盖，然后给源主机发送一个ARP响应数据包，告诉对方自己是它需要查找的MAC地址；
3. 源主机收到这个ARP响应数据包后，将得到的目的主机的IP地址和MAC地址添加到自己的ARP列表中，并利用此信息开始数据的传输。如果源主机一直没有收到ARP响应数据包，表示ARP查询失败。
4. 如果所要找的主机和源主机不在同一个局域网上，那么就要通过 ARP 找到一个位于本局域网上的某个路由器的硬件地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络。

### 6. ICMP协议

**ICMP协议是一个网络层协议。**
一个新搭建好的网络，往往需要先进行一个简单的测试，来验证网络是否畅通；但是IP协议并不提供可靠传输。如果丢包了，IP协议并不能通知传输层是否丢包以及丢包的原因。
所以我们就需要一种协议来完成这样的功能–ICMP协议。

ICMP协议的功能主要有：

1. 确认IP包是否成功到达目标地址
2. 通知在发送过程中IP包被丢弃的原因

![这里写图片描述](https://img-blog.csdn.net/20180530175416942?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzM3OTY0MDcx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

我们需要注意几点：

1. ICMP是基于IP协议工作的，但是它并不是传输层的功能，因此仍然把它归结为网络层协议

2. ICMP只能搭配IPv4使用，如果是IPv6的情况下, 需要是用ICMPv6

ICMP报文的种类

- ICMP差错报告报文
- ICMP询问报文

ICMP 差错报告报文共有 5 种：

- 终点不可达
- 源点抑制(Source quench)
- 时间超过
- 参数问题
- 改变路由（重定向）(Redirect)

ICMP 询问报文有两种：

- 回送请求和回答报文
- 时间戳请求和回答报文

### 7. 路由选择协议

1. **内部网关协议IGP**：一个自治系统内部的路由选择协议，包括RIP，OSPF等
   1. RIP协议
      1. 优缺点：
         1. RIP 存在的一个问题是当网络出现故障时，要经过比较长的时间才能将此信息传送到所有的路由器。
         2. RIP 协议最大的优点就是实现简单，开销较小。
         3. RIP 限制了网络的规模，它能使用的最大距离为 15（16 表示不可达）。
         4. 路由器之间交换的路由信息是路由器中的完整路由表，因而随着网络规模的扩大，开销也就增加。
      2. 特点：
         1. 仅和相邻路由器交换信息
         2. 按固定的时间间隔交换路由信息，例如，每隔30秒。
   2. OSPF协议
      1. 使用洪泛法向本自治系统中所有路由器发送信息。
      2. 发送的信息是与本路由器相邻的所有路由器的链路状态。
      3. 只有当链路状态发生变化时，路由器才用洪泛法向所有路由器发送此信息。
2. **外部网关协议EGP**：一个自治系统的边界，将路由选择信息传递到另一个自治系统。如BGP
   1. BGP：
      1. 自治系统AS之间的路由选择必须考虑有关策略。
      2. BGP只能力求寻找一条能够到达目的网络且比较好的路由，而并非要寻找一条最佳路由。

# 5. 运输层

### 1. 运输层功能

- 运输层为应用进程之间提供端到端的逻辑通信（但网络层是为主机之间提供逻辑通信）
- 运输层还要对收到的报文进行差错检测
- 运输层需要有两种不同的运输协议，即面向连接的 **TCP** 和无连接的 **UDP**

### 2. 用户数据报协议UDP

UDP 在传送数据之前不需要先建立连接。对方的运输层在收到 UDP 报文后，不需要给出任何确认。虽然 UDP 不提供可靠交付，但在某些情况下 UDP 是一种最有效的工作方式。

特点：

- **UDP 是无连接的**，即发送数据之前不需要建立连接。
- **UDP 使用尽最大努力交付**，即不保证可靠交付，同时也不使用拥塞控制
- **UDP 是面向报文的**
- **UDP 没有拥塞控制**，很适合多媒体通信的要求。
- **UDP 支持一对一、一对多、多对一和多对多的交互通信**
- **UDP 的首部开销小**，只有 8 个字节

### 3. **传输控制协议 TCP**

TCP 则提供面向连接的服务。TCP 不提供广播或多播服务。由于 TCP 要提供可靠的、面向连接的运输服务，因此不可避免地增加了许多的开销。这不仅使协议数据单元的首部增大很多，还要占用许多的处理机资源。

特点：

- **TCP 是面向连接的运输层协议**
- **每一条 TCP 连接只能有两个端点(endpoint)**，每一条 TCP 连接只能是点对点的（一对一）
- **TCP 提供可靠交付的服务**
- **TCP 提供全双工通信**
- **面向字节流**